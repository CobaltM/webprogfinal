<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Checkout</title>
    <script
      src="https://code.jquery.com/jquery-3.2.1.min.js"
      integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
      crossorigin="anonymous"></script> 
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body{
            background-repeat: no-repeat;
            background-size: cover;

            font-family: "Lucida Sans Unicode", sans-serif;
        }
        h1{
            text-align: center;
            color: #32425b;
            
            border: solid azure;
            border-radius: 20%;
            padding: 1em;
            background-color: rgb(240, 255, 255, .9);
            margin-left: 30%;
            margin-right: 30%;
        }
        select {
        font-size: 16px;
        font-family: "Lucida Sans Unicode", sans-serif;
        position: relative;
        display: inline-block;
        }
        option{
            font-family: "Lucida Sans Unicode", sans-serif;
            padding:2em;
            min-width: 160px;
            
        }
    </style>
</head>
    <body>
      <a href='viewCart.php'> View Cart </a>
    	<form action="validatecard.php" method="post">
            Cardholder Name: <input required type='text' name='chname' id = 'chname'><br>
            Card Number: <input required type='number' name = 'cardnumber' id = 'cardnumber'><br>
            Exp: <input required type='month' name='expm' id='exp'>&nbsp;&nbsp;&nbsp;&nbsp;
            CVV2: <input required type="number" name="seccode" id = 'seccode'><br>
            <div id='cardimg'>
            </div>
            <br>
            Address: Street <input type="text" id = 'streeta1'> City <input type="text" id = 'citya1'><br>
             State <select name="state" id="state">
                                                  <option value="" selected="selected">Select a State</option>
                                                  <option value="AL">Alabama</option>
                                                  <option value="AK">Alaska</option>
                                                  <option value="AZ">Arizona</option>
                                                  <option value="AR">Arkansas</option>
                                                  <option value="CA">California</option>
                                                  <option value="CO">Colorado</option>
                                                  <option value="CT">Connecticut</option>
                                                  <option value="DE">Delaware</option>
                                                  <option value="DC">District Of Columbia</option>
                                                  <option value="FL">Florida</option>
                                                  <option value="GA">Georgia</option>
                                                  <option value="HI">Hawaii</option>
                                                  <option value="ID">Idaho</option>
                                                  <option value="IL">Illinois</option>
                                                  <option value="IN">Indiana</option>
                                                  <option value="IA">Iowa</option>
                                                  <option value="KS">Kansas</option>
                                                  <option value="KY">Kentucky</option>
                                                  <option value="LA">Louisiana</option>
                                                  <option value="ME">Maine</option>
                                                  <option value="MD">Maryland</option>
                                                  <option value="MA">Massachusetts</option>
                                                  <option value="MI">Michigan</option>
                                                  <option value="MN">Minnesota</option>
                                                  <option value="MS">Mississippi</option>
                                                  <option value="MO">Missouri</option>
                                                  <option value="MT">Montana</option>
                                                  <option value="NE">Nebraska</option>
                                                  <option value="NV">Nevada</option>
                                                  <option value="NH">New Hampshire</option>
                                                  <option value="NJ">New Jersey</option>
                                                  <option value="NM">New Mexico</option>
                                                  <option value="NY">New York</option>
                                                  <option value="NC">North Carolina</option>
                                                  <option value="ND">North Dakota</option>
                                                  <option value="OH">Ohio</option>
                                                  <option value="OK">Oklahoma</option>
                                                  <option value="OR">Oregon</option>
                                                  <option value="PA">Pennsylvania</option>
                                                  <option value="RI">Rhode Island</option>
                                                  <option value="SC">South Carolina</option>
                                                  <option value="SD">South Dakota</option>
                                                  <option value="TN">Tennessee</option>
                                                  <option value="TX">Texas</option>
                                                  <option value="UT">Utah</option>
                                                  <option value="VT">Vermont</option>
                                                  <option value="VA">Virginia</option>
                                                  <option value="WA">Washington</option>
                                                  <option value="WV">West Virginia</option>
                                                  <option value="WI">Wisconsin</option>
                                                  <option value="WY">Wyoming</option>
                                                  </select> Zip <input type="number" id ='zipa1'> <br>
            <br>
            Billing Address: Street <input required type="text" id = 'streeta2'> City <input required type="text" id = 'citya2'><br>

             State <select required name="state" id="state">
                                                  <option value="" selected="selected">Select a State</option>
                                                  <option value="AL">Alabama</option>
                                                  <option value="AK">Alaska</option>
                                                  <option value="AZ">Arizona</option>
                                                  <option value="AR">Arkansas</option>
                                                  <option value="CA">California</option>
                                                  <option value="CO">Colorado</option>
                                                  <option value="CT">Connecticut</option>
                                                  <option value="DE">Delaware</option>
                                                  <option value="DC">District Of Columbia</option>
                                                  <option value="FL">Florida</option>
                                                  <option value="GA">Georgia</option>
                                                  <option value="HI">Hawaii</option>
                                                  <option value="ID">Idaho</option>
                                                  <option value="IL">Illinois</option>
                                                  <option value="IN">Indiana</option>
                                                  <option value="IA">Iowa</option>
                                                  <option value="KS">Kansas</option>
                                                  <option value="KY">Kentucky</option>
                                                  <option value="LA">Louisiana</option>
                                                  <option value="ME">Maine</option>
                                                  <option value="MD">Maryland</option>
                                                  <option value="MA">Massachusetts</option>
                                                  <option value="MI">Michigan</option>
                                                  <option value="MN">Minnesota</option>
                                                  <option value="MS">Mississippi</option>
                                                  <option value="MO">Missouri</option>
                                                  <option value="MT">Montana</option>
                                                  <option value="NE">Nebraska</option>
                                                  <option value="NV">Nevada</option>
                                                  <option value="NH">New Hampshire</option>
                                                  <option value="NJ">New Jersey</option>
                                                  <option value="NM">New Mexico</option>
                                                  <option value="NY">New York</option>
                                                  <option value="NC">North Carolina</option>
                                                  <option value="ND">North Dakota</option>
                                                  <option value="OH">Ohio</option>
                                                  <option value="OK">Oklahoma</option>
                                                  <option value="OR">Oregon</option>
                                                  <option value="PA">Pennsylvania</option>
                                                  <option value="RI">Rhode Island</option>
                                                  <option value="SC">South Carolina</option>
                                                  <option value="SD">South Dakota</option>
                                                  <option value="TN">Tennessee</option>
                                                  <option value="TX">Texas</option>
                                                  <option value="UT">Utah</option>
                                                  <option value="VT">Vermont</option>
                                                  <option value="VA">Virginia</option>
                                                  <option value="WA">Washington</option>
                                                  <option value="WV">West Virginia</option>
                                                  <option value="WI">Wisconsin</option>
                                                  <option value="WY">Wyoming</option>
                                                  </select> Zip <input required type="number" id ='zipa2'> <br>
            <br>
            Phone: (<input type="num" id="pnac">)<input type="num" id="pnn">
            <div id='submitgoeshere'></div>
            
            
        </form>
        <script>
            var valid= false;
            var discover=/^6(?:011. 5[0-9]{2})[0-9]{12}$/g;
            var visa = /^4[0-9]{12}(?:[0-9]{3})?$/g;
            var mastercard = /^(?:5[1-5][0-9]{2}|222[1-9]|22[3-9][0-9]|2[3-6][0-9]{2}|27[01][0-9]|2720)[0-9]{12}$/g;
            var amex = /^3[47][0-9]{13}$/g;
            function readCard(cn){
                var fd=cn;
                var sd = cn;
                while(fd>=10){
                    if(fd<100&&fd>9){
                        sd=fd/10;
                        fd=Math.floor(fd/10);
                        sd=Math.round((sd-fd)*10);
                        continue;
                    }
                    fd=Math.floor(fd/10);
                }
                if(cn<10){
                    sd=null;
                }
                if(fd==6){
                    //discover
                    document.getElementById('cardimg').innerHTML='<img src="discover.jpg" />';
                    if(cn==cn.match(discover)){
                        valid=true;
                    }
                }
                else if(fd==4){
                    //visa
                    document.getElementById('cardimg').innerHTML='<img src="visa.jpg" />';
                    console.log(cn.match(visa));
                    if(cn==cn.match(visa)){
                        valid=true;
                    }
                }
                else if(fd==5&&sd>0&&sd<6){
                    console.log(sd);
                    console.log(fd);
                    //mastercard
                    document.getElementById('cardimg').innerHTML='<img src="mastercard.jpg" />';
                    if(cn==cn.match(mastercard)){
                        valid=true;
                    }
                }
                else if(fd==3&&(sd==4||sd==7)){
                    //amex
                    document.getElementById('cardimg').innerHTML='<img src="amex.jpg" />';
                    if(cn==cn.match(amex)){
                        valid=true;
                    }
                }
                if(valid){
                    console.log("valid!!!");
                }
            }
        function isValid(){
            if(!valid){
                alert("Enter a valid cc number!!!");
            }   
        }
        var lastValue = '';
                setInterval(function() {
                    if(valid){
                        document.getElementById("submitgoeshere").innerHTML='<input type="submit" action="isValid();" value="Confirm">';
                    }
                    if ($("#cardnumber").val() != lastValue) {
                        lastValue = $("#cardnumber").val();
                        readCard($("#cardnumber").val());
                    }
                }, 500);
        </script>
</body>
</html>